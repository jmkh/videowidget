!function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return i(n||e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){var r={getCookie:function(e){var t=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.$?*|{}\(\)\[\]\\\/\+^])/g,"\\$1")+"=([^;]*)"));return t?decodeURIComponent(t[1]):void 0},setCookie:function(e,t,n){n=n||{};var r=n.expires;if("number"==typeof r&&r){var i=new Date;i.setTime(i.getTime()+1e3*r),r=n.expires=i}r&&r.toUTCString&&(n.expires=r.toUTCString()),t=encodeURIComponent(t);var o=e+"="+t;for(var s in n){o+="; "+s;var a=n[s];a!==!0&&(o+="="+a)}document.cookie=o},deleteCookie:function(e){this.setCookie(e,"",{expires:-1})},hashCode:function(e){return e.split("").reduce(function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e},0)},getUserID:function(){var e=this.getCookie("MpVideoVisitorID"),t=this;return e||(e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),t.setCookie("MpVideoVisitorID",e,{expires:864e3})),e},saveObject:function(e,t){var n=btoa(encodeURIComponent(JSON.stringify(e))),r=t||this.hashCode(n).toString(16);return this.setCookie(r,n,{expires:864e3}),r},getObject:function(e,t){var n=this.getCookie(e),r=null;if(void 0!==n&&n){var i=decodeURIComponent(atob(n));r=JSON.parse(i)}return void 0!==t&&t&&this.deleteCookie(e),r}};t.exports=r},{}],2:[function(e,t,n){function r(e){this.slot=e||document.querySelector("#videoslot"),this.slot.style.position="absolute",this.slot.style.top="0",this.slot.style.left="0",this.slot.style.width="100%",this.slot.style.height="100%",this.slot.style.zIndex=999,this.tick=function(){},this.player=null;var t=i.getUserID(),n=i.getObject(t);n||(n={mute:!1,tvo:.2,vo:.7}),this.plSettings=n}var i=e("./CookieDriver");r.prototype.clear=function(){this.slot.innerHTML="",this.slot.style.display="none"},r.prototype.renderControl=function(e,t){switch(e){case"timeoutEl":var n=parseInt(t.dur)-parseInt(t.sec);n=n>0?n:0;var r="<span class='innerSpan'>Реклама: "+n;return t.showControls&&t.skipTime>0&&(r+="  Пропустить через: "+(t.skipTime>0?t.skipTime:0)),r+=" </span>";case"advLink":return"<span class='innerSpan' >"+t+"</span>";case"skipAd":return"<span class='innerSpan'>Пропустить </span>";case"closeAd":return"<span class='innerSpan'> </span>";case"muteButton":return"<span class='innerSpan "+(t?"un":"")+"mute'> </span>";default:return""}},r.prototype.init=function(e){var t=this;t.clear(),t.player=e,t.player.adVolume=t.plSettings.mute?0:t.plSettings.vo,3==e.pType&&(t.Extentions={linkTxt:"Перейти на сайт рекламодателя",isClickable:0,controls:0,skipTime:"00:10",skipTime2:"00:05",skipAd:[],addClick:[]},t.player.vast.map("ads[0].extensions",function(e){"linkTxt"==e.type&&e.value&&(t.Extentions.linkTxt=e.value.replace(/^\s+|\s+$/,"")),"isClickable"==e.type&&e.value&&(t.Extentions.isClickable=e.value.replace(/^\s+|\s+$/,"")),"controls"==e.type&&e.value&&(t.Extentions.controls=e.value.replace(/^\s+|\s+$/,"")),"skipTime"==e.type&&e.value&&(t.Extentions.skipTime=e.value.replace(/^\s+|\s+$/,"")),"skipTime2"==e.type&&e.value&&(t.Extentions.skipTime2=e.value.replace(/^\s+|\s+$/,"")),"skipAd"==e.type&&e.value&&t.Extentions.skipAd.push(e.value.replace(/^\s+|\s+$/,"")),"addClick"==e.type&&e.value&&t.Extentions.addClick.push(e.value.replace(/^\s+|\s+$/,""))}),t.drawControls(),t.clickable.onclick=function(){t.ConrolePaused(t.Extentions.isClickable)},t.player.on("AdRemainingTimeChange",function(e){t.ControllerAction(e)}),this.slot.style.display="block")},r.prototype.drawControls=function(){var e=this;e.clickable=document.createElement("DIV"),e.clickable.setAttribute("id","clickable"),e.clickable.style.width="100%",e.clickable.style.height="100%",e.clickable.style.border="1px solid #000000",e.clickable.style.position="absolute",e.clickable.style.top="0",e.clickable.style.left="0",e.clickable.style.cursor="pointer",e.clickable.style.zIndex=1e3,e.slot.appendChild(e.clickable),e.resumeButton=document.createElement("DIV"),e.resumeButton.style.zIndex=1003,e.resumeButton.style.color="#FFFFFF",e.resumeButton.style.width="100%",e.resumeButton.style.height="100%",e.resumeButton.style.cursor="pointer",e.resumeButton.style.display="none",e.resumeButton.className="resume-play",e.clickable.appendChild(e.resumeButton);var t=document.createElement("div");t.id="timeoutDiv",e.player.timeoutDiv=t,e.slot.appendChild(t);var n=document.createElement("div");n.id="closeDiv",e.player.closeDiv=n,e.slot.appendChild(n),n.innerHTML=e.renderControl("closeAd"),n.style.display="none",n.onclick=function(t){t.preventDefault(),e.player.emit("close"),e.player.stopAd()};var r=document.createElement("div");e.player.skipDiv=r,r.id="skipDiv",e.slot.appendChild(r),r.innerHTML=e.renderControl("skipAd"),r.style.display="none",r.onclick=function(t){t.preventDefault(),e.player.emit("skip");for(var n=0;n<e.Extentions.skipAd.length;n++)(new Image).src=e.Extentions.skipAd[n];e.player.stopAd()};var o=document.createElement("div");o.id="advLink",e.player.advLink=o,e.slot.appendChild(o),o.innerHTML=e.renderControl("advLink",decodeURIComponent(e.Extentions.linkTxt)),e.player.vast.get("ads[0].creatives[0].videoClicks.clickThrough")||(o.style.display="none"),o.onclick=function(t){t.preventDefault();for(var n=0;n<e.Extentions.addClick.length;n++)(new Image).src=e.Extentions.addClick[n];e.ConrolePaused(1)};var s=document.createElement("div");s.id="muteButton",s.style.border="1px solid red",s.style.zIndex=9999,s.style.position="absolute",e.player.muteButton=s,e.slot.appendChild(s),s.innerHTML=e.renderControl("muteButton",e.player.adVolume),s.onclick=function(t){t.preventDefault(),e.player.adVolume=e.player.adVolume?0:.6;var n=i.getUserID();return e.player.adVolume?e.plSettings.mute=!1:e.plSettings.mute=!0,i.saveObject(e.plSettings,n),e.player.muteButton.innerHTML=e.renderControl("muteButton",e.player.adVolume),!1}},r.prototype.ControllerAction=function(e){var t=this;if(void 0!==t.player.timeoutDiv){var n=(60*parseInt(t.Extentions.skipTime.split(":")[0])+parseInt(t.Extentions.skipTime.split(":")[1]))%parseInt(e.dur),r=(60*parseInt(t.Extentions.skipTime2.split(":")[0])+parseInt(t.Extentions.skipTime2.split(":")[1]))%parseInt(e.dur);n>r&&(n=r);var i=r<=parseInt(e.sec)&&r>0,o=n<=parseInt(e.sec)&&n>0;e.skipTime=n-parseInt(e.sec),e.showControls="1"==t.Extentions.controls;var s=t.renderControl("timeoutEl",e);t.player.timeoutDiv.innerHTML=s,"1"==t.Extentions.controls&&i&&(t.player.closeDiv.style.display="block"),"1"==t.Extentions.controls&&o&&(t.player.skipDiv.style.display="block")}},r.prototype.ConrolePaused=function(e){if(this.player.isPaused)void 0!==this.resumeButton&&(this.resumeButton.style.display="none"),this.player.isPaused=0,this.player.resumeAd();else{this.player.isPaused=1,this.player.pauseAd(),this.resumeButton,this.resumeButton.style.display="block",this.player.emit("clickThrough");var t=this.player.vast.get("ads[0].creatives[0].videoClicks.clickThrough");e&&t&&window.open(t)}},t.exports=r},{"./CookieDriver":1}],3:[function(e,t,n){function r(e,t){var n={};e=e||{};for(var r in t)t.hasOwnProperty(r)&&(n[r]=e[r]||t[r]);return n}function i(e){function t(e){s.emit("ready",e),i.autoplay&&s.play()}function n(e){window.YT=YT,s.emit("statechange",{event:e})}var i=r(e,{container:"player",width:"550",height:"350",videoId:"Ug3ucX2hGBc",autoplay:!1});console.log(i);var o=document.createElement("script"),s=this;o.src="https://www.youtube.com/iframe_api";var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(o,a),this.ready=!1;var u;window.onYouTubeIframeAPIReady=function(){s.ready=!0,u=new YT.Player(i.container,{height:i.height,width:i.width,videoId:i.videoId,events:{onReady:t,onStateChange:n}})},this.stop=function(){s.ready&&void 0!==u&&u?u.stopVideo():s.once("ready",function(){s.stop()})},this.play=function(){s.ready&&void 0!==u&&u?u.playVideo():s.once("ready",function(){s.play()})},this.pause=function(){s.ready&&void 0!==u&&u?u.pauseVideo():s.once("ready",function(){s.pause()})},this.setVolume=function(e){s.ready&&void 0!==u&&u?u.setVolume(e):s.once("ready",function(){s.setVolume(e)})}}var o=e("events").EventEmitter;!function(e,t){if("function"==typeof Object.create)e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}});else{e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}(i,o),t.exports={player:i}},{events:8}],4:[function(e,t,n){"use strict";function r(){var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];if(navigator.platform)for(;e.length;)if(navigator.platform===e.pop())return!0;return!1}function i(e){var t={size:{width:"350",height:"400"},container:"#mp-video-widget-container-56015401b3da9-20",auth:{affiliate_id:"56015401b3da9",pid:"20"},errorFn:function(){},successFn:function(e){console.log(e)}},n=t;for(var i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);var s=this;this.loaded=!1,this.configUrl="https://widget.market-place.su/videooptions/"+n.auth.affiliate_id+"_"+n.auth.pid+".json?p="+Math.random();var a=e.errorFn||function(){};e.successFn;o.ajax(this.configUrl,{errorFn:a,successFn:function(e){try{var t=JSON.parse(e);if(void 0!==t.error)throw new Error("Виджет удалён.");for(var i in t)t.hasOwnProperty(i)&&(s[i]=t[i]);var a=/Android|Silk|Mobile|PlayBook/.test(window.navigator.userAgent),u=r();switch(s.isDesktop=!a,!0){case u:s.ads=t["ads-mobile"].iOS;break;case a:s.ads=t["ads-mobile"].Android}o.ajax("https://widget.market-place.su/proxy_referer/",{errorFn:function(){},successFn:function(e){try{var r=JSON.parse(e);s.loaded=!0,s.referer=r,n.successFn(s),window.parent.postMessage(t,"*")}catch(e){console.log("битая конфигурация",e)}}})}catch(e){console.log("битая конфигурация",e)}}})}var o=e("./httpclient");t.exports=i},{"./httpclient":6}],5:[function(e,t,n){"use strict";function r(e,t,n){this.controller=document.getElementById(e),this.container=document.getElementById(e),this.placeholder=document.getElementById(n),this.extraslot=document.createElement("DIV"),this.extraslot.id="videoslot",this.container.appendChild(this.extraslot),this.VideoSlot=new s(this.extraslot),this.queueToPLay=[],this.queueToPlaySemaphore=0,this.queueSemaphores={},this.queueToPlayExit=0,this.loadedStatuses={},this.cachedConf={},this.loadedCnt=0,this.playedCnt=0,this.config={},this.links=[],this.AllowedStart=0,this.timerToClose=40,this.collbackFunction=function(){},this.indexMassive={33:2},this.cacheStatisticIndexes={},this.cookieUserid=o.getUserID(),this.referer="http://apptoday.ru";var r=this;void 0===this.GlobalMyGUITemp&&(this.GlobalMyGUITemp="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),window.GlobalMyGUITemp=this.GlobalMyGUITemp),this.fromUrl=window.location!=window.parent.location?document.referrer:document.location.href,window.addEventListener("resize",function(){console.log(["resize 1"]),r.calculateParameters()},!1),r.calculateParameters(),this.clearAll()}var i=e("vast-player"),o=e("./CookieDriver"),s=e("./VideoSlot");r.prototype.timerToCloseFn=function(){if(this.timerToClose<0){this.LastControllerPan=document.createElement("DIV"),this.LastControllerPan.style.position="absolute",this.LastControllerPan.style.top="calc(50% - 50px)",this.LastControllerPan.style.left="calc(50% - 50px)",this.LastControllerPan.style.opacity="0.5",this.LastControllerPan.style.filter="alpha(Opacity=50)",this.LastControllerPan.style.color="#FFFFFF",this.LastControllerPan.style.zIndex="4500",this.LastControllerPan.className="lastController",this.LastcloseRemain=document.createElement("DIV"),this.LastcloseRemain.style.display="block",this.LastcloseRemain.style.marginLeft="5px",this.LastcloseRemain.fontSize="12px",this.LastcloseDiv=document.createElement("DIV"),this.LastcloseDiv.style.marginLeft="5px",this.LastcloseDiv.style.backgroundImage="url(https://apptoday.ru/ug/img/exit.png) ",this.LastcloseDiv.style.backgroundRepeat="no-repeat",this.LastcloseDiv.style.backgroundSize="contain",this.LastcloseDiv.style.content="",this.LastcloseDiv.className="hover_button",this.LastcloseDiv.style.width="100px",this.LastcloseDiv.style.height="100px",this.LastcloseDiv.title="закрыть рекламу",this.LastcloseDiv.style.cursor="pointer",this.LastcloseDiv.style.display="block";var e=this;return this.LastcloseDiv.onmouseout=function(){e.LastControllerPan.style.opacity="0.5",e.LastControllerPan.style.filter="alpha(Opacity=50)"},this.LastcloseDiv.onmouseover=function(){e.LastControllerPan.style.opacity="0.8",e.LastControllerPan.style.filter="alpha(Opacity=80)"},this.LastcloseDiv.onclick=function(){return document.body.innerHTML="",window.parent.postMessage({die:1},"*"),!0},this.LastControllerPan.appendChild(this.LastcloseRemain),this.LastControllerPan.appendChild(this.LastcloseDiv),void(this.controller&&this.controller.appendChild(this.LastControllerPan))}this.timerToClose--;var e=this;setTimeout(function(){e.timerToCloseFn()},1e3)},r.prototype.calculateParameters=function(){var e=screen.width,t=screen.height;console.log("Разрешение окна клиента: "+e+"| x |"+t)},r.prototype.clearAll=function(){this.clearController(),this.clearContainer(),this.clearExtraSlot()},r.prototype.clearController=function(){this.controller.style.display="none"},r.prototype.showController=function(){this.controller.style.display="block"},r.prototype.clearContainer=function(){this.container.style.display="none"},r.prototype.showContainer=function(){this.container.style.display="block"},r.prototype.clearPlaceholder=function(){this.placeholder.style.display="none"},r.prototype.showPlaceholder=function(){this.placeholder.style.display="block"},r.prototype.clearExtraSlot=function(){this.extraslot.style.display="none"},r.prototype.showExtraSlot=function(){this.extraslot.style.display="block"},r.prototype.setConfig=function(e,t){e.hasOwnProperty("adslimit")||(e.adslimit=3),this.config=e,e.hasOwnProperty("referer")&&e.referer&&(this.referer=e.referer),this.collbackFunction=t,this.loadedCnt=e.ads.length,this.timerToCloseFn();for(var n=this,r=0,o=e.ads.length;r<o;r++){r&&this.loadedCnt/r<=2&&(this.indexMassive[e.ads[r].id]=2),this.cachedConf[e.ads[r].id]={title:e.ads[r].title};var s="bycredit_"+e.ads[r].id,a=this.prepareFrame(s),u=new i(a,{withCredentials:!0,bidgeFn:function(e,t,r){switch(t){case"firstQuartile":n.sendStatistic({id:e,eventName:"filterPlayMedia"})}n.sendStatistic({id:e,eventName:t}),console.log(["111-",n.timerToClose,n.cachedConf[e].title,t])}});u.id_local_source=e.ads[r].id,u.local_title=e.ads[r].title,this.loadQueue(e.ads[r],u)}},r.prototype.prepareFrame=function(e){var t=document.createElement("DIV");return t.id=e,t.style.display="none",t.style.width="100%",t.style.height="100%",this.container.appendChild(t),t},r.prototype.loadQueue=function(e,t){if(!this.queueToPlayExit){var n=this,r=e.src.replace(/\{([a-z]+)\}/g,function(e){switch(e.replace(/[\{\}]+/g,"")){case"rnd":return Math.random();case"ref":return encodeURIComponent(n.referer)}return e});this.loadedStatuses[e.id]=0,this.sendStatistic({id:e.id,eventName:"srcRequest"}),t.once("AdStopped",function(){n.deleteSemaphore(t.id_local_source),console.log([95558,"Плеер закончился!",t.id_local_source,t.local_title]),n.checkStatus({id:t.id_local_source,event:"ended"}),t.container.style.display="none"}),t.once("AdError",function(e){n.sendTmp({id:t.id_local_source,event:"on error :"+t.local_title}),n.deleteSemaphore(t.id_local_source);var r="";void 0!==e&&void 0!==e.message?r=e.message:void 0!==e&&(r=JSON.stringify(e)),n.sendStatistic({id:t.id_local_source,eventName:"errorPlayMedia",mess:r}),console.log([95558,"Ошибка плеера лог!",t.local_title,e]),n.loadedStatuses[t.id_local_source]=2,n.checkStatus({id:t.id_local_source,event:"error : "+t.local_title}),t.container.style.display="none"}),t.on("AdRemainingTimeChange",function(e){e.hasOwnProperty("sec")&&e.sec&&e.sec>3&&n.sendStatistic({id:this.id_local_source,eventName:"filterPlayMedia"})}),n.sendTmp({id:e.id,event:"try load :"+t.local_title}),t.load(r).then(function(){n.sendTmp({id:e.id,event:"loaded ok :"+t.local_title}),console.log([95558,"Плеер заргузился",t.pType,e.id,e.title]),t.startAd().then(function(r){t.pauseAd(),console.log([95558,"Плеер готов",e.id,e.title]),n.loadedStatuses[e.id]=1,n.filterQueue(t)}).catch(function(r){n.sendTmp({id:t.id_local_source,event:"on noready :"+t.local_title}),n.loadedStatuses[e.id]=2,console.log([95558,"Плеер не готов",e.title,r]),n.deleteSemaphore(e.id),n.checkStatus({id:e.id,event:"error1"}),t.container.style.display="none"})}).catch(function(r){n.sendTmp({id:t.id_local_source,event:"on noload :"+t.local_title}),n.deleteSemaphore(e.id),n.loadedStatuses[e.id]=2,console.log([95558,"Плеер не загрузился",t.local_title,r]),n.checkStatus({id:e.id,event:"noload :"+t.local_title}),t.container.style.display="none"})}},r.prototype.secondQueue=function(e){console.log(["id_player отложен",this.cachedConf[e.id_local_source].title]);var t,n=0,r=0;for(t in this.loadedStatuses)t!=e.id_local_source&&1==this.loadedStatuses[t]&&(console.log(["id_player в это время",this.indexMassive.hasOwnProperty(t),this.loadedStatuses[t],this.cachedConf[t].title]),r=1),n++;(r=0)||(this.queueToPLay.push(e),this.playQueue())},r.prototype.filterQueue=function(e){if(this.indexMassive.hasOwnProperty(e.id_local_source)){var t=this;return void setTimeout(function(){t.secondQueue(e)},1e3)}this.queueToPLay.push(e),this.playQueue()},r.prototype.setSemaphore=function(e){this.queueSemaphores[e]=1},r.prototype.deleteSemaphore=function(e){void 0!==this.queueToPlaySemaphore&&delete this.queueSemaphores[e]},r.prototype.checkSemaphores=function(){this.queueToPlaySemaphore=0;var e;for(e in this.queueSemaphores)return void(this.queueToPlaySemaphore=1)},r.prototype.playQueue=function(e){if(!((e=void 0===e?20:e)<=0||this.queueToPlayExit)){this.checkSemaphores();var t=this;if(this.queueToPlaySemaphore)return void setTimeout(function(){t.playQueue()},500);var t,n=this.queueToPLay.shift();if(n){this.setSemaphore(n.id_local_source),this.playedCnt++;var r=n.container;console.log([95558,"Плеер на паузе",n.pType,n.local_title]),this.showController(),this.showContainer(),this.clearPlaceholder(),this.VideoSlot.init(n),r.style.display="block",this.sendStatistic({id:n.id_local_source,eventName:"startPlayMedia"}),n.resumeAd(),this.clearPlaceholder()}}},r.prototype.checkStatus=function(e){if(this.queueToPlayExit)return!0;this.checkSemaphores();var t,n=0,r=0,i=0;for(t in this.loadedStatuses)this.loadedStatuses[t]||(r=1),n++;return e.fin="",e.matrix=this.loadedStatuses,e.status=[n,this.loadedCnt,this.queueToPlaySemaphore,this.queueToPLay.length,r],n!=this.loadedCnt||r||this.queueToPlaySemaphore||this.queueToPLay.length||(i=1,e.fin="finish self"),this.sendPixel(e),console.log([n,this.loadedCnt,this.queueToPlaySemaphore,this.queueToPLay.length,r]),!r&&(!!i&&(this.playExit(),!0))},r.prototype.playExit=function(){this.queueToPlayExit||(this.queueToPlayExit=1,this.VideoSlot.clear(),console.log(["play exit"]),this.controller.style.display="none",this.collbackFunction(this.config))},r.prototype.sendTmp=function(e){e.fin="",e.matrix=[],e.status=[],this.sendPixel(e)},r.prototype.sendPixel=function(e){return},r.prototype.sendStatistic=function(e){var t="";if(void 0!==e.eventName&&(void 0===this.cacheStatisticIndexes[e.id]&&(this.cacheStatisticIndexes[e.id]={}),void 0!==e.mess&&(t=e.mess),void 0===this.cacheStatisticIndexes[e.id][e.eventName])){this.cacheStatisticIndexes[e.id][e.eventName]=1;var n={key:this.GlobalMyGUITemp,fromUrl:encodeURIComponent(this.fromUrl),pid:this.config.pid,affiliate_id:this.config.affiliate_id,cookie_id:this.cookieUserid,id_src:e.id,event:e.eventName,mess:t},r="https://api.market-place.su/Product/video/l1stat.php?p="+Math.random()+"&data="+encodeURIComponent(JSON.stringify(n));console.log(["статистика 2",e.eventName,e.id,e.eventName,r]);new Image(1,1).src=r}},t.exports=r},{"./CookieDriver":1,"./VideoSlot":2,"vast-player":25}],6:[function(e,t,n){"use strict";var r={ajax:function(e,t){var n=e;t=t||{};var r=t.errorFn||function(){},i=t.successFn||function(){},o=t.type||"GET",s=t.data||{},a=JSON.stringify(s);if(o=o.toUpperCase(),window.XMLHttpRequest)var u=new XMLHttpRequest;else var u=new ActiveXObject("Microsoft.XMLHTTP");if("GET"==o){a=null,n.indexOf("?")<0&&(n+="?1=1");for(var c in s)s.hasOwnProperty(c)&&(n+="&"+c+"="+s[c])}u.open(o,n,!0),u.onreadystatechange=function(){4==u.readyState?200==u.status?i({response:u.responseText}):r({status:u.status}):r({status:u.readyState})},u.onreadystatechange=function(){4==u.readyState&&(200==u.status?i(u.responseText):r({status:u.status}))};try{u.withCredentials=t.withCredentials||!1,u.send(a)}catch(e){}}};t.exports=r},{}],7:[function(e,t,n){function r(e){if(e)return i(e)}function i(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}void 0!==t&&(t.exports=r),r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},r.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r,i=0;i<n.length;i++)if((r=n[i])===t||r.fn===t){n.splice(i,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks["$"+e];if(n){n=n.slice(0);for(var r=0,i=n.length;r<i;++r)n[r].apply(this,t)}return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],8:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,o,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],a(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(r=arguments.length,o=new Array(r-1),u=1;u<r;u++)o[u-1]=arguments[u];n.apply(this,o)}else if(s(n)){for(r=arguments.length,o=new Array(r-1),u=1;u<r;u++)o[u-1]=arguments[u];for(c=n.slice(),r=c.length,u=0;u<r;u++)c[u].apply(this,o)}return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned){var n;n=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,o,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=o;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){r=a;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.listenerCount=function(e,t){return e._events&&e._events[t]?i(e._events[t])?1:e._events[t].length:0}},{}],9:[function(e,t,n){(function(e){"use strict";function n(){l=!0;for(var e,t,n=p.length;n;){for(t=p,p=[],e=-1;++e<n;)t[e]();n=p.length}l=!1}function r(e){1!==p.push(e)||l||i()}var i,o=e.MutationObserver||e.WebKitMutationObserver;if(o){var s=0,a=new o(n),u=e.document.createTextNode("");a.observe(u,{characterData:!0}),i=function(){u.data=s=++s%2}}else if(e.setImmediate||void 0===e.MessageChannel)i="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){n(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(n,0)};else{var c=new e.MessageChannel;c.port1.onmessage=n,i=function(){c.port2.postMessage(0)}}var l,p=[];t.exports=r}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],10:[function(e,t,n){"use strict";function r(){}function i(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=g,this.queue=[],this.outcome=void 0,e!==r&&u(this,e)}function o(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function s(e,t,n){f(function(){var r;try{r=t(n)}catch(t){return v.reject(e,t)}r===e?v.reject(e,new TypeError("Cannot resolve promise with itself")):v.resolve(e,r)})}function a(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function u(e,t){function n(t){o||(o=!0,v.reject(e,t))}function r(t){o||(o=!0,v.resolve(e,t))}function i(){t(r,n)}var o=!1,s=c(i);"error"===s.status&&n(s.value)}function c(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}function l(e){return e instanceof this?e:v.resolve(new this(r),e)}function p(e){var t=new this(r);return v.reject(t,e)}function d(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);for(var o=new Array(n),s=0,a=-1,u=new this(r);++a<n;)!function(e,r){function a(e){o[r]=e,++s!==n||i||(i=!0,v.resolve(u,o))}t.resolve(e).then(a,function(e){i||(i=!0,v.reject(u,e))})}(e[a],a);return u}function h(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);for(var o=-1,s=new this(r);++o<n;)!function(e){t.resolve(e).then(function(e){i||(i=!0,v.resolve(s,e))},function(e){i||(i=!0,v.reject(s,e))})}(e[o]);return s}var f=e("immediate"),v={},y=["REJECTED"],m=["FULFILLED"],g=["PENDING"];t.exports=i,i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){if("function"!=typeof e&&this.state===m||"function"!=typeof t&&this.state===y)return this;var n=new this.constructor(r);if(this.state!==g){s(n,this.state===m?e:t,this.outcome)}else this.queue.push(new o(n,e,t));return n},o.prototype.callFulfilled=function(e){v.resolve(this.promise,e)},o.prototype.otherCallFulfilled=function(e){s(this.promise,this.onFulfilled,e)},o.prototype.callRejected=function(e){v.reject(this.promise,e)},o.prototype.otherCallRejected=function(e){s(this.promise,this.onRejected,e)},v.resolve=function(e,t){var n=c(a,t);if("error"===n.status)return v.reject(e,n.value);var r=n.value;if(r)u(e,r);else{e.state=m,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},v.reject=function(e,t){e.state=y,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},i.resolve=l,i.reject=p,i.all=d,i.race=h},{immediate:9}],11:[function(e,t,n){!function(e,n){"use strict";"object"==typeof t&&"object"==typeof t.exports?t.exports=n():"function"==typeof define&&define.amd?define([],n):e.objectPath=n()}(this,function(){"use strict";function e(e){if(!e)return!0;if(o(e)&&0===e.length)return!0;for(var t in e)if(p.call(e,t))return!1;return!0}function t(e){return l.call(e)}function n(e){return"number"==typeof e||"[object Number]"===t(e)}function r(e){return"string"==typeof e||"[object String]"===t(e)}function i(e){return"object"==typeof e&&"[object Object]"===t(e)}function o(e){return"object"==typeof e&&"number"==typeof e.length&&"[object Array]"===t(e)}function s(e){return"boolean"==typeof e||"[object Boolean]"===t(e)}function a(e){var t=parseInt(e);return t.toString()===e?t:e}function u(t,i,o,s){if(n(i)&&(i=[i]),e(i))return t;if(r(i))return u(t,i.split("."),o,s);var c=a(i[0]);if(1===i.length){var l=t[c];return void 0!==l&&s||(t[c]=o),l}return void 0===t[c]&&(n(c)?t[c]=[]:t[c]={}),u(t[c],i.slice(1),o,s)}function c(t,i){if(n(i)&&(i=[i]),!e(t)){if(e(i))return t;if(r(i))return c(t,i.split("."));var s=a(i[0]),u=t[s];if(1===i.length)void 0!==u&&(o(t)?t.splice(s,1):delete t[s]);else if(void 0!==t[s])return c(t[s],i.slice(1));return t}}var l=Object.prototype.toString,p=Object.prototype.hasOwnProperty,d={};return d.ensureExists=function(e,t,n){return u(e,t,n,!0)},d.set=function(e,t,n,r){return u(e,t,n,r)},d.insert=function(e,t,n,r){var i=d.get(e,t);r=~~r,o(i)||(i=[],d.set(e,t,i)),i.splice(r,0,n)},d.empty=function(t,a){if(e(a))return t;if(!e(t)){var u,c;if(!(u=d.get(t,a)))return t;if(r(u))return d.set(t,a,"");if(s(u))return d.set(t,a,!1);if(n(u))return d.set(t,a,0);if(o(u))u.length=0;else{if(!i(u))return d.set(t,a,null);for(c in u)p.call(u,c)&&delete u[c]}}},d.push=function(e,t){var n=d.get(e,t);o(n)||(n=[],d.set(e,t,n)),n.push.apply(n,Array.prototype.slice.call(arguments,2))},d.coalesce=function(e,t,n){for(var r,i=0,o=t.length;i<o;i++)if(void 0!==(r=d.get(e,t[i])))return r;return n},d.get=function(t,i,o){if(n(i)&&(i=[i]),e(i))return t;if(e(t))return o;if(r(i))return d.get(t,i.split("."),o);var s=a(i[0]);return 1===i.length?void 0===t[s]?o:t[s]:d.get(t[s],i.slice(1),o)},d.del=function(e,t){return c(e,t)},d})},{}],12:[function(e,t,n){function r(){}var i=t.exports={};i.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){
return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){n.shift()()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),i.title="browser",i.browser=!0,i.env={},i.argv=[],i.on=r,i.addListener=r,i.once=r,i.off=r,i.removeListener=r,i.removeAllListeners=r,i.emit=r,i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],13:[function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,o){t=t||"&",n=n||"=";var s={};if("string"!=typeof e||0===e.length)return s;e=e.split(t);var a=1e3;o&&"number"==typeof o.maxKeys&&(a=o.maxKeys);var u=e.length;a>0&&u>a&&(u=a);for(var c=0;c<u;++c){var l,p,d,h,f=e[c].replace(/\+/g,"%20"),v=f.indexOf(n);v>=0?(l=f.substr(0,v),p=f.substr(v+1)):(l=f,p=""),d=decodeURIComponent(l),h=decodeURIComponent(p),r(s,d)?i(s[d])?s[d].push(h):s[d]=[s[d],h]:s[d]=h}return s};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],14:[function(e,t,n){"use strict";function r(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var i=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,a){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?r(s(e),function(r){var s=encodeURIComponent(i(r))+n;return o(e[r])?e[r].map(function(e){return s+encodeURIComponent(i(e))}).join(t):s+encodeURIComponent(i(e[r]))}).join(t):a?encodeURIComponent(i(a))+n+encodeURIComponent(i(e)):""};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},s=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},{}],15:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode"),n.encode=n.stringify=e("./encode")},{"./decode":13,"./encode":14}],16:[function(e,t,n){t.exports=function(e,t,n){for(var r=0,i=e.length,o=3==arguments.length?n:e[r++];r<i;)o=t.call(null,o,e[r],++r,e);return o}},{}],17:[function(e,t,n){var r,i,o,s=e("object-path");o=function(e){return function(t){return typeof t===e}},i=function(e,t){var n=1,r=t||function(e,t){return t};return"-"===e[0]&&(n=-1,e=e.substr(1)),function(t,i){var o,a=r(e,s.get(t,e)),u=r(e,s.get(i,e));return a<u&&(o=-1),a>u&&(o=1),a===u&&(o=0),o*n}},r=function(){var e=Array.prototype.slice.call(arguments),t=e.filter(o("string")),n=e.filter(o("function"))[0];return function(e,r){for(var o=t.length,s=0,a=0;0===s&&a<o;)s=i(t[a],n)(e,r),a++;return s}},t.exports=r},{"object-path":11}],18:[function(e,t,n){function r(){}function i(e){switch({}.toString.call(e)){case"[object File]":case"[object Blob]":case"[object FormData]":return!0;default:return!1}}function o(e){if(!b(e))return e;var t=[];for(var n in e)null!=e[n]&&s(t,n,e[n]);return t.join("&")}function s(e,t,n){if(Array.isArray(n))return n.forEach(function(n){s(e,t,n)});e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))}function a(e){for(var t,n,r={},i=e.split("&"),o=0,s=i.length;o<s;++o)n=i[o],t=n.split("="),r[decodeURIComponent(t[0])]=decodeURIComponent(t[1]);return r}function u(e){var t,n,r,i,o=e.split(/\r?\n/),s={};o.pop();for(var a=0,u=o.length;a<u;++a)n=o[a],t=n.indexOf(":"),r=n.slice(0,t).toLowerCase(),i=A(n.slice(t+1)),s[r]=i;return s}function c(e){return/[\/+]json\b/.test(e)}function l(e){return e.split(/ *; */).shift()}function p(e){return m(e.split(/ *; */),function(e,t){var n=t.split(/ *= */),r=n.shift(),i=n.shift();return r&&i&&(e[r]=i),e},{})}function d(e,t){t=t||{},this.req=e,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||void 0===this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText,this.setStatusProperties(this.xhr.status),this.header=this.headers=u(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this.setHeaderProperties(this.header),this.body="HEAD"!=this.req.method?this.parseBody(this.text?this.text:this.xhr.response):null}function h(e,t){var n=this;this._query=this._query||[],this.method=e,this.url=t,this.header={},this._header={},this.on("end",function(){var e=null,t=null;try{t=new d(n)}catch(t){return e=new Error("Parser is unable to parse the response"),e.parse=!0,e.original=t,e.rawResponse=n.xhr&&n.xhr.responseText?n.xhr.responseText:null,e.statusCode=n.xhr&&n.xhr.status?n.xhr.status:null,n.callback(e)}if(n.emit("response",t),e)return n.callback(e,t);if(t.status>=200&&t.status<300)return n.callback(e,t);var r=new Error(t.statusText||"Unsuccessful HTTP response");r.original=e,r.response=t,r.status=t.status,n.callback(r,t)})}function f(e,t){var n=w("DELETE",e);return t&&n.end(t),n}var v,y=e("emitter"),m=e("reduce"),g=e("./request-base"),b=e("./is-object");v="undefined"!=typeof window?window:"undefined"!=typeof self?self:this;var w=t.exports=e("./request").bind(null,h);w.getXHR=function(){if(!(!v.XMLHttpRequest||v.location&&"file:"==v.location.protocol&&v.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(e){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}return!1};var A="".trim?function(e){return e.trim()}:function(e){return e.replace(/(^\s*|\s*$)/g,"")};w.serializeObject=o,w.parseString=a,w.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},w.serialize={"application/x-www-form-urlencoded":o,"application/json":JSON.stringify},w.parse={"application/x-www-form-urlencoded":a,"application/json":JSON.parse},d.prototype.get=function(e){return this.header[e.toLowerCase()]},d.prototype.setHeaderProperties=function(e){var t=this.header["content-type"]||"";this.type=l(t);var n=p(t);for(var r in n)this[r]=n[r]},d.prototype.parseBody=function(e){var t=w.parse[this.type];return!t&&c(this.type)&&(t=w.parse["application/json"]),t&&e&&(e.length||e instanceof Object)?t(e):null},d.prototype.setStatusProperties=function(e){1223===e&&(e=204);var t=e/100|0;this.status=this.statusCode=e,this.statusType=t,this.info=1==t,this.ok=2==t,this.clientError=4==t,this.serverError=5==t,this.error=(4==t||5==t)&&this.toError(),this.accepted=202==e,this.noContent=204==e,this.badRequest=400==e,this.unauthorized=401==e,this.notAcceptable=406==e,this.notFound=404==e,this.forbidden=403==e},d.prototype.toError=function(){var e=this.req,t=e.method,n=e.url,r="cannot "+t+" "+n+" ("+this.status+")",i=new Error(r);return i.status=this.status,i.method=t,i.url=n,i},w.Response=d,y(h.prototype);for(var x in g)h.prototype[x]=g[x];h.prototype.abort=function(){if(!this.aborted)return this.aborted=!0,this.xhr&&this.xhr.abort(),this.clearTimeout(),this.emit("abort"),this},h.prototype.type=function(e){return this.set("Content-Type",w.types[e]||e),this},h.prototype.responseType=function(e){return this._responseType=e,this},h.prototype.accept=function(e){return this.set("Accept",w.types[e]||e),this},h.prototype.auth=function(e,t,n){switch(n||(n={type:"basic"}),n.type){case"basic":var r=btoa(e+":"+t);this.set("Authorization","Basic "+r);break;case"auto":this.username=e,this.password=t}return this},h.prototype.query=function(e){return"string"!=typeof e&&(e=o(e)),e&&this._query.push(e),this},h.prototype.attach=function(e,t,n){return this._getFormData().append(e,t,n||t.name),this},h.prototype._getFormData=function(){return this._formData||(this._formData=new v.FormData),this._formData},h.prototype.send=function(e){var t=b(e),n=this._header["content-type"];if(t&&b(this._data))for(var r in e)this._data[r]=e[r];else"string"==typeof e?(n||this.type("form"),n=this._header["content-type"],this._data="application/x-www-form-urlencoded"==n?this._data?this._data+"&"+e:e:(this._data||"")+e):this._data=e;return!t||i(e)?this:(n||this.type("json"),this)},d.prototype.parse=function(e){return v.console&&console.warn("Client-side parse() method has been renamed to serialize(). This method is not compatible with superagent v2.0"),this.serialize(e),this},d.prototype.serialize=function(e){return this._parser=e,this},h.prototype.callback=function(e,t){var n=this._callback;this.clearTimeout(),n(e,t)},h.prototype.crossDomainError=function(){var e=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");e.crossDomain=!0,e.status=this.status,e.method=this.method,e.url=this.url,this.callback(e)},h.prototype.timeoutError=function(){var e=this._timeout,t=new Error("timeout of "+e+"ms exceeded");t.timeout=e,this.callback(t)},h.prototype.withCredentials=function(){return this._withCredentials=!0,this},h.prototype.end=function(e){var t=this,n=this.xhr=w.getXHR(),o=this._query.join("&");this._timeout=6e3;var s=this._timeout,a=this._formData||this._data;this._callback=e||r,n.onreadystatechange=function(){if(4==n.readyState){var e;try{e=n.status}catch(t){e=0}if(0==e){if(t.timedout)return t.timeoutError();if(t.aborted)return;return t.crossDomainError()}t.emit("end")}};var u=function(e){e.total>0&&(e.percent=e.loaded/e.total*100),e.direction="download",t.emit("progress",e)};this.hasListeners("progress")&&(n.onprogress=u);try{n.upload&&this.hasListeners("progress")&&(n.upload.onprogress=u)}catch(e){}if(s&&!this._timer&&(this._timer=setTimeout(function(){t.timedout=!0,t.abort()},s)),o&&(o=w.serializeObject(o),this.url+=~this.url.indexOf("?")?"&"+o:"?"+o),this.username&&this.password?n.open(this.method,this.url,!0,this.username,this.password):n.open(this.method,this.url,!0),this._withCredentials&&(n.withCredentials=!0),n.withCredentials=!0,"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof a&&!i(a)){var l=this._header["content-type"],p=this._parser||w.serialize[l?l.split(";")[0]:""];!p&&c(l)&&(p=w.serialize["application/json"]),p&&(a=p(a))}for(var d in this.header)null!=this.header[d]&&n.setRequestHeader(d,this.header[d]);return this._responseType&&(n.responseType=this._responseType),this.emit("request",this),n.send(void 0!==a?a:null),this},w.Request=h,w.get=function(e,t,n){var r=w("GET",e);return"function"==typeof t&&(n=t,t=null),t&&r.query(t),n&&r.end(n),r},w.head=function(e,t,n){var r=w("HEAD",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r},w.del=f,w.delete=f,w.patch=function(e,t,n){var r=w("PATCH",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r},w.post=function(e,t,n){var r=w("POST",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r},w.put=function(e,t,n){var r=w("PUT",e);return"function"==typeof t&&(n=t,t=null),t&&r.send(t),n&&r.end(n),r}},{"./is-object":19,"./request":21,"./request-base":20,emitter:7,reduce:16}],19:[function(e,t,n){function r(e){return null!=e&&"object"==typeof e}t.exports=r},{}],20:[function(e,t,n){var r=e("./is-object");n.clearTimeout=function(){return this._timeout=0,clearTimeout(this._timer),this},n.parse=function(e){return this._parser=e,this},n.timeout=function(e){return this._timeout=e,this},n.then=function(e,t){return this.end(function(n,r){n?t(n):e(r)})},n.use=function(e){return e(this),this},n.get=function(e){return this._header[e.toLowerCase()]},n.getHeader=n.get,n.set=function(e,t){if(r(e)){for(var n in e)this.set(n,e[n]);return this}return this._header[e.toLowerCase()]=t,this.header[e]=t,this},n.unset=function(e){return delete this._header[e.toLowerCase()],delete this.header[e],this},n.field=function(e,t){return this._getFormData().append(e,t),this}},{"./is-object":19}],21:[function(e,t,n){function r(e,t,n){return"function"==typeof n?new e("GET",t).end(n):2==arguments.length?new e("GET",t):new e(t,n)}t.exports=r},{}],22:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],23:[function(e,t,n){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],24:[function(e,t,n){(function(t,r){function i(e,t){var r={seen:[],stylize:s};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),v(t)?r.showHidden=t:t&&n._extend(r,t),A(r.showHidden)&&(r.showHidden=!1),A(r.depth)&&(r.depth=2),A(r.colors)&&(r.colors=!1),A(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=o),u(r,e,r.depth)}function o(e,t){var n=i.styles[t];return n?"["+i.colors[n][0]+"m"+e+"["+i.colors[n][1]+"m":e}function s(e,t){return e}function a(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}function u(e,t,r){if(e.customInspect&&t&&k(t.inspect)&&t.inspect!==n.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(r,e);return b(i)||(i=u(e,i,r)),i}var o=c(e,t);if(o)return o;var s=Object.keys(t),v=a(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),E(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return l(t);if(0===s.length){if(k(t)){var y=t.name?": "+t.name:"";return e.stylize("[Function"+y+"]","special")}if(x(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(T(t))return e.stylize(Date.prototype.toString.call(t),"date");if(E(t))return l(t)}var m="",g=!1,w=["{","}"];if(f(t)&&(g=!0,w=["[","]"]),k(t)){m=" [Function"+(t.name?": "+t.name:"")+"]"}if(x(t)&&(m=" "+RegExp.prototype.toString.call(t)),T(t)&&(m=" "+Date.prototype.toUTCString.call(t)),E(t)&&(m=" "+l(t)),0===s.length&&(!g||0==t.length))return w[0]+m+w[1];if(r<0)return x(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var A;return A=g?p(e,t,r,v,s):s.map(function(n){return d(e,t,r,v,n,g)}),e.seen.pop(),h(A,m,w)}function c(e,t){if(A(t))return e.stylize("undefined","undefined");if(b(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return g(t)?e.stylize(""+t,"number"):v(t)?e.stylize(""+t,"boolean"):y(t)?e.stylize("null","null"):void 0}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function p(e,t,n,r,i){for(var o=[],s=0,a=t.length;s<a;++s)I(t,String(s))?o.push(d(e,t,n,r,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(d(e,t,n,r,i,!0))}),o}function d(e,t,n,r,i,o){var s,a,c;if(c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]},c.get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),I(r,i)||(s="["+i+"]"),a||(e.seen.indexOf(c.value)<0?(a=y(n)?u(e,c.value,null):u(e,c.value,n-1),a.indexOf("\n")>-1&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n"))):a=e.stylize("[Circular]","special")),A(s)){if(o&&i.match(/^\d+$/))return a;s=JSON.stringify(""+i),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function h(e,t,n){var r=0;return e.reduce(function(e,t){return r++,t.indexOf("\n")>=0&&r++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function f(e){return Array.isArray(e)}function v(e){return"boolean"==typeof e}function y(e){return null===e}function m(e){return null==e}function g(e){return"number"==typeof e}function b(e){return"string"==typeof e}function w(e){return"symbol"==typeof e}function A(e){return void 0===e}function x(e){return _(e)&&"[object RegExp]"===S(e)}function _(e){return"object"==typeof e&&null!==e}function T(e){return _(e)&&"[object Date]"===S(e)}function E(e){return _(e)&&("[object Error]"===S(e)||e instanceof Error)}function k(e){return"function"==typeof e}function C(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function S(e){return Object.prototype.toString.call(e)}function P(e){return e<10?"0"+e.toString(10):e.toString(10)}function L(){var e=new Date,t=[P(e.getHours()),P(e.getMinutes()),P(e.getSeconds())].join(":");return[e.getDate(),V[e.getMonth()],t].join(" ")}function I(e,t){return Object.prototype.hasOwnProperty.call(e,t)}n.format=function(e){if(!b(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(i(arguments[n]));return t.join(" ")}for(var n=1,r=arguments,o=r.length,s=String(e).replace(/%[sdj%]/g,function(e){if("%%"===e)return"%";if(n>=o)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}}),a=r[n];n<o;a=r[++n])y(a)||!_(a)?s+=" "+a:s+=" "+i(a);return s},n.deprecate=function(e,i){function o(){if(!s){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),s=!0}return e.apply(this,arguments)}if(A(r.process))return function(){return n.deprecate(e,i).apply(this,arguments)};if(t.noDeprecation===!0)return e;var s=!1;return o};var j,D={};n.debuglog=function(e){if(A(j)&&(j=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!D[e])if(new RegExp("\\b"+e+"\\b","i").test(j)){var r=t.pid;D[e]=function(){var t=n.format.apply(n,arguments);console.error("%s %d: %s",e,r,t)}}else D[e]=function(){};return D[e]},n.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=f,n.isBoolean=v,n.isNull=y,n.isNullOrUndefined=m,n.isNumber=g,n.isString=b,n.isSymbol=w,n.isUndefined=A,n.isRegExp=x,n.isObject=_,n.isDate=T,n.isError=E,n.isFunction=k,n.isPrimitive=C,n.isBuffer=e("./support/isBuffer");var V=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",L(),n.format.apply(n,arguments))},n.inherits=e("inherits"),n._extend=function(e,t){if(!t||!_(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,e("pBGvAp"),"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":23,inherits:22,pBGvAp:12}],25:[function(e,t,n){t.exports=e("./lib/VASTPlayer")},{"./lib/VASTPlayer":29}],26:[function(e,t,n){"use strict";function r(e,t,n){t.on(e,function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];n.emit.apply(n,[e].concat(t))})}function i(e,t,n){n.forEach(function(n){t.listeners(n).length>0&&r(n,e,t)}),t.on("newListener",function(i){n.indexOf(i)>-1&&t.listeners(i).length<1&&r(i,e,t)})}function o(e){this.events=e.slice(),this.__private__={target:null,source:null}}o.prototype.from=function(e){return this.__private__.source=e,this.__private__.target&&i(e,this.__private__.target,this.events),this},o.prototype.to=function(e){return this.__private__.target=e,this.__private__.source&&i(this.__private__.source,e,this.events),this},t.exports=o},{}],27:[function(e,t,n){"use strict";function r(e){var t=this;i.call(this,Math.floor(e.duration||0)),this.video=e,[s.PLAYING,s.PAUSE,s.TIMEUPDATE].forEach(function(n){return e.addEventListener(n,function(){return t.tick()},!1)})}var i=e("./VideoTracker"),o=e("util").inherits,s=e("./enums/HTML_MEDIA_EVENTS");o(r,i),r.prototype._getState=function(){return{playing:!this.video.paused,currentTime:this.video.currentTime}},t.exports=r},{"./VideoTracker":31,"./enums/HTML_MEDIA_EVENTS":32,util:24}],28:[function(e,t,n){"use strict";function r(e){return e}function i(e,t){(e||[]).forEach(function(e){(new Image).src=t(e)})}function o(e,t){this.pixels=e.reduce(function(e,t){return(e[t.event]||(e[t.event]=[])).push(t.uri),e},{}),this.__private__={mapper:t||r}}var s=e("./enums/VPAID_EVENTS");o.prototype.track=function(e){function t(e,t,s){function u(e){return a((t||r)(e))}return function(){if(!s||s()){var t=o.PlayToBridge(e,n[e]);console.log(["flag",t,e]),i(n[e],u)}}}var n=this.pixels,o=this,a=this.__private__.mapper,u=e.adVolume;e.on(s.AdSkipped,t("skip")),e.on(s.AdStarted,t("creativeView")),e.on(s.AdVolumeChange,t("unmute",null,function(){return 0===u&&e.adVolume>0})),e.on(s.AdVolumeChange,t("mute",null,function(){return u>0&&0===e.adVolume})),e.on(s.AdImpression,t("impression")),e.on(s.AdVideoStart,t("start")),e.on(s.AdVideoFirstQuartile,t("firstQuartile")),e.on(s.AdVideoMidpoint,t("midpoint")),e.on(s.AdVideoThirdQuartile,t("thirdQuartile")),e.on(s.AdVideoComplete,t("complete")),e.on(s.AdClickThru,t("clickThrough")),e.on(s.AdUserAcceptInvitation,t("acceptInvitationLinear")),e.on(s.AdUserMinimize,t("collapse")),e.on(s.AdUserClose,t("closeLinear")),e.on(s.AdPaused,t("pause")),e.on(s.AdPlaying,t("resume")),e.on(s.AdError,t("error",function(e){return e.replace(/\[ERRORCODE\]/g,901)})),e.on(s.AdVolumeChange,function(){u=e.adVolume})},t.exports=o},{"./enums/VPAID_EVENTS":34}],29:[function(e,t,n){"use strict";function r(){var e=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"];if(navigator.platform)for(;e.length;)if(navigator.platform===e.pop())return!0;return!1}function i(){var e=!1;if(void 0!==navigator.plugins&&"object"==typeof navigator.plugins["Shockwave Flash"])e=!0;else if(void 0!==window.ActiveXObject)try{new ActiveXObject("ShockwaveFlash.ShockwaveFlash")&&(e=!0)}catch(e){}return e}function o(){var e,t,n,r,i={},s=arguments.length;for(e=0;e<s;e++){t=arguments[e]||{};for(n in t)r=t[n],void 0===i[n]&&(i[n]=r),"object"==typeof r&&(i[n]=o(i[n],r))}return i}function s(e){return e}function a(){return new Error("VASTPlayer not ready.")}function u(e){return function(){var t=this,n=this.__private__.player;return this.ready?n[e].apply(n,arguments).then(function(){return t}):A.reject(a())}}function c(e){return{get:function(){if(!this.ready)throw a();return this.__private__.player[e]},set:function(t){if(!this.ready)throw a();return this.__private__.player[e]=t}}}function l(e,t){var n=this;p.call(this),this.__private__={container:e,config:o(t,{vast:{withCredentials:!0,resolveWrappers:!0,maxRedirects:7},tracking:{mapper:s}}),vast:null,ready:!1,player:null,pType:0},this.on(b.AdClickThru,function(e,t,r){var i=e||n.vast.get("ads[0].creatives[0].videoClicks.clickThrough");r&&i&&window.open(i)})}var p=e("events").EventEmitter,d=e("util").inherits,h=e("vastacular").VAST,f=e("./players/JavaScriptVPAID"),v=e("./players/FlashVPAID"),y=e("./players/HTMLVideo"),m=e("./players/IOSVideo"),g=e("./enums/MIME"),b=e("./enums/VPAID_EVENTS"),w=e("./EventProxy"),A=e("lie"),x=e("./PixelReporter");d(l,p),Object.defineProperties(l.prototype,{container:{get:function(){return this.__private__.container}},config:{get:function(){return this.__private__.config}},vast:{get:function(){return this.__private__.vast}},ready:{get:function(){return this.__private__.ready}},adRemainingTime:c("adRemainingTime"),adDuration:c("adDuration"),adVolume:c("adVolume")}),l.prototype.load=function(e){var t=this,n=this.config.vast;return h.fetch(e,n).then(function(e){var n=r(),o=function(){var r=e.filter("ads[0].creatives[0].mediaFiles",function(e){return(e.type===g.JAVASCRIPT||"application/x-javascript"===e.type)&&"VPAID"===e.apiFramework}),o=e.filter("ads[0].creatives[0].mediaFiles",function(e){return e.type===g.FLASH&&"VPAID"===e.apiFramework&&i()}),s=e.filter("ads[0].creatives[0].mediaFiles",function(){return!0});return r.length>0?(t.pType=1,{player:new f(t.container),mediaFiles:r}):o.length>0?(t.pType=2,{player:new v(t.container,l.vpaidSWFLocation),mediaFiles:o}):(t.pType=3,n?{player:new m(t.container),mediaFiles:s}:{player:new y(t.container),mediaFiles:s})}(),s=e.get("ads[0].creatives[0].parameters"),a=[].concat(e.map("ads[0].impressions",function(e){return{event:"impression",uri:e.uri}}),e.map("ads[0].errors",function(e){return{event:"error",uri:e}}),e.get("ads[0].creatives[0].trackingEvents"),e.map("ads[0].creatives[0].videoClicks.clickTrackings",function(e){return{event:"clickThrough",uri:e}})),u=o.player,c=o.mediaFiles,p=new w(b),d=new x(a,t.config.tracking.mapper);return d.PlayToBridge=function(e,t){return 1},"function"==typeof t.config.bidgeFn&&(d.PlayToBridge=function(e,n){return t.config.bidgeFn(t.id_local_source,e,n),1}),p.from(u).to(t),t.__private__.vast=e,t.__private__.player=u,u.load(c,s).then(function(){d.track(u)})}).then(function(){return t.__private__.ready=!0,t.emit("ready"),t}).catch(function(e){throw t.emit("error",e),e})},l.prototype.startAd=u("startAd"),l.prototype.stopAd=u("stopAd"),l.prototype.pauseAd=u("pauseAd"),l.prototype.resumeAd=u("resumeAd"),l.vpaidSWFLocation="https://cdn.jsdelivr.net/vast-player/0.2.9/vast-player--vpaid.swf",t.exports=l},{"./EventProxy":26,"./PixelReporter":28,"./enums/MIME":33,"./enums/VPAID_EVENTS":34,"./players/FlashVPAID":36,"./players/HTMLVideo":37,"./players/IOSVideo":38,"./players/JavaScriptVPAID":39,events:8,lie:10,util:24,vastacular:43}],30:[function(e,t,n){"use strict";function r(e){var t=e.split(".").map(parseFloat);this.string=e,this.major=t[0],this.minor=t[1],this.patch=t[2],Object.freeze(this)}r.prototype.toString=function(){return this.string},t.exports=r},{}],31:[function(e,t,n){"use strict";function r(e,t){t.fired[e]||(t.emit(e),t.fired[e]=!0)}function i(e){o.apply(this,arguments),this.duration=e,this.seconds=Array.apply([],new Array(e)).map(function(){return!1}),this.fired=[a.AdVideoStart,a.AdVideoFirstQuartile,a.AdVideoMidpoint,a.AdVideoThirdQuartile,a.AdVideoComplete].reduce(function(e,t){return e[t]=!1,e},{})}var o=e("events").EventEmitter,s=e("util").inherits,a=e("./enums/VPAID_EVENTS");s(i,o),i.prototype.tick=function(){function e(e){var n=o[e-1];return t.slice(0,n).every(function(e){return e===!0})}var t=this.seconds,n=this._getState(),i=Math.round(n.currentTime)-1;i>-1&&this.emit(a.AdRemainingTimeChange,{sec:i,dur:this.duration});var o=[1,2,3,4].map(function(e){return Math.floor(this.duration/4*e)},this);n.playing&&(r(a.AdVideoStart,this),i>-1&&(this.seconds[i]=!0)),e(1)&&r(a.AdVideoFirstQuartile,this),e(2)&&r(a.AdVideoMidpoint,this),e(3)&&r(a.AdVideoThirdQuartile,this),e(4)&&r(a.AdVideoComplete,this)},t.exports=i},{"./enums/VPAID_EVENTS":34,events:8,util:24}],32:[function(e,t,n){"use strict";var r=["abort","canplay","canplaythrough","durationchange","emptied","encrypted","ended","error","interruptbegin","interruptend","loadeddata","loadedmetadata","loadstart","mozaudioavailable","pause","play","playing","progress","ratechange","seeked","seeking","stalled","suspend","timeupdate","volumechange","waiting"];r.forEach(function(e){this[e.toUpperCase()]=e},r),Object.freeze(r),t.exports=r},{}],33:[function(e,t,n){var r={JAVASCRIPT:"application/javascript",FLASH:"application/x-shockwave-flash"};Object.freeze(r),t.exports=r},{}],34:[function(e,t,n){"use strict";var r=["AdLoaded","AdStarted","AdStopped","AdSkipped","AdSkippableStateChange","AdSizeChange","AdLinearChange","AdDurationChange","AdExpandedChange","AdRemainingTimeChange","AdVolumeChange","AdImpression","AdVideoStart","AdVideoFirstQuartile","AdVideoMidpoint","AdVideoThirdQuartile","AdVideoComplete","AdClickThru","AdInteraction","AdUserAcceptInvitation","AdUserMinimize","AdUserClose","AdPaused","AdPlaying","AdLog","AdError"];r.forEach(function(e){r[e]=e}),Object.freeze(r),t.exports=r},{}],35:[function(e,t,n){"use strict";var r=e("./window"),i=document.createElement("video"),o=e("./enums/MIME");n.isDesktop=!/Android|Silk|Mobile|PlayBook/.test(r.navigator.userAgent),n.canPlay=function(e){var t=r.navigator.mimeTypes,n=r.ActiveXObject;switch(e){case o.FLASH:try{return new n("ShockwaveFlash.ShockwaveFlash")?2:0}catch(e){return t&&t[o.FLASH]?2:0}return 0;case o.JAVASCRIPT:case"application/x-javascript":return 2;default:if(i.canPlayType)switch(i.canPlayType(e)){case"probably":return 2;case"maybe":return 1;default:return 0}}return 0},Object.freeze(n)},{"./enums/MIME":33,"./window":42}],36:[function(e,t,n){"use strict";function r(e,t){i.apply(this,arguments),this.swfURI=t,this.object=null}var i=e("./VPAID"),o=e("util").inherits,s=e("lie"),a=e("../uuid"),u=e("querystring"),c=e("../enums/VPAID_EVENTS"),l=e("../VPAIDVersion");o(r,i),r.prototype.load=function(e,t){var n=this,r=e[0].uri,i=e[0].bitrate;return new s(function(e,o){function s(e){n.container.removeChild(p),n.api=null,n.object=null,delete window[d],e&&o(e)}var p=document.createElement("object"),d="vast_player__"+a(20),h=u.stringify({vpaidURI:r,eventCallback:d});p.type="application/x-shockwave-flash",p.data=n.swfURI+"?"+h,p.style.display="block",p.style.width="100%",p.style.height="100%",p.style.border="none",p.style.opacity="0",p.innerHTML=['<param name="movie" value="'+n.swfURI+'">','<param name="flashvars" value="'+h+'">','<param name="quality" value="high">','<param name="play" value="false">','<param name="loop" value="false">','<param name="wmode" value="opaque">','<param name="scale" value="noscale">','<param name="salign" value="lt">','<param name="allowScriptAccess" value="always">'].join("\n"),n.object=p,window[d]=function(e){switch(e.type){case c.AdClickThru:return n.emit(e.type,e.url,e.Id,e.playerHandles);case c.AdInteraction:case c.AdLog:return n.emit(e.type,e.Id);case c.AdError:return n.emit(e.type,e.message);default:return n.emit(e.type)}},n.once("VPAIDInterfaceReady",function(){var e=p.getBoundingClientRect(),r=n.vpaidVersion=new l(p.handshakeVersion("2.0"));if(r.major>2)return o(new Error("VPAID version "+r+" is not supported."));n.on("VPAIDInterfaceResize",function(){var e=p.getBoundingClientRect();n.resizeAd(e.width,e.height,"normal")}),p.initAd(e.width,e.height,"normal",i,t,null)}),n.once(c.AdLoaded,function(){n.api=p,p.style.opacity="1",e(n)}),n.once(c.AdError,function(e){s(new Error(e))}),n.once(c.AdStopped,s),n.container.appendChild(p)})},t.exports=r},{"../VPAIDVersion":30,"../enums/VPAID_EVENTS":34,"../uuid":41,"./VPAID":40,lie:10,querystring:15,util:24}],37:[function(e,t,n){"use strict";function r(e,t,n){return e.addEventListener(t,n,!1)}function i(e,t,n){return e.removeEventListener(t,n,!1)}function o(e,t,n){return r(e,t,function r(){return i(e,t,r),n.apply(this,arguments)})}function s(e,t){function n(){return new Error("The <video> has not been loaded.")}return function(){if(!this.video){if(t)return p.reject(n());throw n()}return e.apply(this,arguments)}}function a(e,t){var n=t.width,r=e.map(function(e){return{mediaFile:e,playability:d(e.type)}}).filter(function(e){return e.playability>0}).sort(h("-playability","-mediaFile.bitrate")),i=r.map(function(e){return Math.abs(n-e.mediaFile.width)}),o=r[i.indexOf(Math.min.apply(Math,i))];return!o||o.playability<1?null:o.mediaFile}function u(e){this.container=e,this.video=null,this.__private__={hasPlayed:!1}}var c=e("events").EventEmitter,l=e("util").inherits,p=e("lie"),d=e("../environment").canPlay,h=e("sort-by"),f=e("../enums/VPAID_EVENTS"),v=e("../enums/HTML_MEDIA_EVENTS"),y=e("../HTMLVideoTracker"),m=e("../EventProxy");l(u,c),Object.defineProperties(u.prototype,{adRemainingTime:{get:s(function(){return this.video.duration-this.video.currentTime})},adDuration:{get:s(function(){return this.video.duration})},adVolume:{get:s(function(){return this.video.volume}),set:s(function(e){this.video.volume=e})}}),u.prototype.load=function(e){var t=this;return new p(function(n,i){var s=document.createElement("video"),u=a(e,t.container.getBoundingClientRect())
;if(!u)return i(new Error("There are no playable <MediaFile>s."));s.setAttribute("webkit-playsinline",!0),s.src=u.uri,s.preload="auto",s.style.display="block",s.style.width="100%",s.style.height="100%",s.style.objectFit="contain",o(s,v.LOADEDMETADATA,function(){var e=new y(s);new m(f).from(e).to(t),t.video=s,n(t),t.emit(f.AdLoaded),r(s,v.DURATIONCHANGE,function(){t.emit(f.AdDurationChange)}),r(s,v.VOLUMECHANGE,function(){t.emit(f.AdVolumeChange)})}),o(s,v.ERROR,function(){var e=s.error;t.emit(f.AdError,e.message),i(e)}),o(s,v.PLAYING,function(){t.__private__.hasPlayed=!0,t.emit(f.AdImpression)}),o(s,v.ENDED,function(){t.stopAd()}),r(s,"click",function(){t.emit(f.AdClickThru,null,null,!0)}),t.container.appendChild(s)})},u.prototype.startAd=s(function(){var e=this,t=this.video;return t.volume=.1,this.__private__.hasPlayed?p.reject(new Error("The ad has already been started.")):new p(function(n){return o(t,v.PLAYING,function(){n(e),e.emit(f.AdStarted)}),t.play()})},!0),u.prototype.stopAd=s(function(){return this.container.removeChild(this.video),this.emit(f.AdStopped),p.resolve(this)},!0),u.prototype.pauseAd=s(function(){var e=this,t=this.video;return this.video.paused?p.resolve(this):new p(function(n){return o(t,v.PAUSE,function(){n(e),e.emit(f.AdPaused)}),t.pause()})},!0),u.prototype.resumeAd=s(function(){var e=this,t=this.video;return this.__private__.hasPlayed?this.video.paused?new p(function(n){return o(t,v.PLAY,function(){n(e),e.emit(f.AdPlaying)}),t.play()}):p.resolve(this):p.reject(new Error("The ad has not been started yet."))},!0),t.exports=u},{"../EventProxy":26,"../HTMLVideoTracker":27,"../enums/HTML_MEDIA_EVENTS":32,"../enums/VPAID_EVENTS":34,"../environment":35,events:8,lie:10,"sort-by":17,util:24}],38:[function(e,t,n){"use strict";function r(e,t,n){return e.addEventListener(t,n,!1)}function i(e,t,n){return e.removeEventListener(t,n,!1)}function o(e,t,n){return r(e,t,function r(){return i(e,t,r),n.apply(this,arguments)})}function s(e,t){function n(){return new Error("The <video> has not been loaded.")}return function(){if(!this.video){if(t)return p.reject(n());throw n()}return e.apply(this,arguments)}}function a(e,t){var n=t.width,r=e.map(function(e){return{mediaFile:e,playability:d(e.type)}}).filter(function(e){return e.playability>0}).sort(h("-playability","-mediaFile.bitrate")),i=r.map(function(e){return Math.abs(n-e.mediaFile.width)}),o=r[i.indexOf(Math.min.apply(Math,i))];return!o||o.playability<1?null:o.mediaFile}function u(e){this.container=e,this.video=null,this.__private__={hasPlayed:!1}}var c=e("events").EventEmitter,l=e("util").inherits,p=e("lie"),d=e("../environment").canPlay,h=e("sort-by"),f=e("../enums/VPAID_EVENTS"),v=e("../enums/HTML_MEDIA_EVENTS"),y=e("../HTMLVideoTracker"),m=e("../EventProxy");l(u,c),Object.defineProperties(u.prototype,{adRemainingTime:{get:s(function(){return this.video.duration-this.video.currentTime})},adDuration:{get:s(function(){return this.video.duration})},adVolume:{get:s(function(){return this.video.volume}),set:s(function(e){this.video.volume=e})}}),u.prototype.load=function(e){var t=this;return new p(function(n,i){var s=document.createElement("video"),u=a(e,t.container.getBoundingClientRect());if(!u)return i(new Error("There are no playable <MediaFile>s."));s.setAttribute("muted",!0),s.setAttribute("playsinline",!0),s.setAttribute("webkit-playsinline",!0),s.src=u.uri,s.preload="auto",s.style.display="block",s.style.width="100%",s.style.height="100%",s.style.objectFit="contain",o(s,v.LOADEDMETADATA,function(){var e=new y(s);new m(f).from(e).to(t),t.video=s,n(t),t.emit(f.AdLoaded),r(s,v.DURATIONCHANGE,function(){t.emit(f.AdDurationChange)}),r(s,v.VOLUMECHANGE,function(){t.emit(f.AdVolumeChange)})}),o(s,v.ERROR,function(){var e=s.error;t.emit(f.AdError,e.message),i(e)}),o(s,v.PLAYING,function(){t.__private__.hasPlayed=!0,t.emit(f.AdImpression)}),o(s,v.ENDED,function(){t.stopAd()}),r(s,"click",function(){t.emit(f.AdClickThru,null,null,!0)}),t.container.appendChild(s)})},u.prototype.startAd=s(function(){var e=this,t=this.video;return this.__private__.hasPlayed?p.reject(new Error("The ad has already been started.")):new p(function(n){return o(t,v.PLAYING,function(){n(e),e.emit(f.AdStarted)}),window.enableInlineVideo(t,{everywhere:!0}),t.play()})},!0),u.prototype.stopAd=s(function(){return this.emit(f.AdStopped),p.resolve(this)},!0),u.prototype.pauseAd=s(function(){var e=this,t=this.video;return this.video.paused?p.resolve(this):(t.className="",new p(function(n){return o(t,v.PAUSE,function(){n(e),e.emit(f.AdPaused)}),t.pause()}))},!0),u.prototype.resumeAd=s(function(){var e=this,t=this.video;return this.__private__.hasPlayed?(t.className="IIV",this.video.paused?new p(function(n){return o(t,v.PLAY,function(){n(e),e.emit(f.AdPlaying)}),t.play()}):p.resolve(this)):p.reject(new Error("The ad has not been started yet."))},!0),t.exports=u},{"../EventProxy":26,"../HTMLVideoTracker":27,"../enums/HTML_MEDIA_EVENTS":32,"../enums/VPAID_EVENTS":34,"../environment":35,events:8,lie:10,"sort-by":17,util:24}],39:[function(e,t,n){"use strict";function r(){o.apply(this,arguments),this.playDelay=1,this.frame=null}var i=e("util").inherits,o=e("./VPAID"),s=e("lie"),a=e("../enums/VPAID_EVENTS"),u=e("../environment").isDesktop,c=e("../VPAIDVersion");i(r,o),r.prototype.load=function(e,t){var n=this,r=e[0].uri,i=e[0].bitrate;return new s(function(e,o){function s(e){try{n.container.removeChild(p)}catch(e){console.log(["iframe error"])}n.frame=null,n.api=null,e&&o(e)}function l(e){if(n.playDelay)return e>0?void setTimeout(function(){l(e-1)},1e3):void s(new Error("vpaid не загрузился в течении 7 сек"))}var p=document.createElement("iframe");p.scrolling="no";var d=document.createElement("script"),h=document.createElement("video");l(9),p.src="about:blank",p.style.width="100%",p.style.height="100%",p.style.display="block",p.style.opacity="0",p.style.border="none",h.setAttribute("webkit-playsinline","true"),h.style.display="block",h.style.width="100%",h.style.height="100%",h.style.objectFit="contain",n.container.appendChild(p),p.contentWindow.document.open(),p.contentWindow.document.close(),p.contentWindow.document.body.style.margin="0",n.frame=p,d.src=r,d.onload=function(){function r(){var e=p.getBoundingClientRect();n.resizeAd(e.width,e.height,"normal")}var l=p.contentWindow.getVPAIDAd(),d=p.getBoundingClientRect(),f=p.contentWindow.document.body,v=n.vpaidVersion=new c(l.handshakeVersion("2.0"));if(v.major>2)return o(new Error("VPAID version "+v+" is not supported."));p.contentWindow.addEventListener("resize",r,!1),a.forEach(function(e){return l.subscribe(function(){for(var t=new Array(arguments.length),r=arguments.length;r--;)t[r]=arguments[r];return n.emit.apply(n,[e].concat(t))},e)}),n.once(a.AdLoaded,function(){n.playDelay=0,p.style.opacity="1",n.api=l,e(n)}),n.once(a.AdError,function(e){s(new Error(e))}),n.once(a.AdStopped,s),l.initAd(d.width,d.height,"normal",i,{AdParameters:t},{slot:f,videoSlot:h,videoSlotCanAutoPlay:u})},d.onerror=function(){s(new Error("Failed to load MediaFile ["+r+"]."))},p.contentWindow.document.body.appendChild(h),p.contentWindow.document.head.appendChild(d)})},t.exports=r},{"../VPAIDVersion":30,"../enums/VPAID_EVENTS":34,"../environment":35,"./VPAID":40,lie:10,util:24}],40:[function(e,t,n){"use strict";function r(e,t){return function(){function n(){return new Error("Ad has not been loaded.")}function r(){return o[e].apply(o,i)}var i=arguments,o=this.api,s=this;if(!t){if(!o)throw n();return r()}return new a(function(e,i){return o?(s.once(t,function(){e(s)}),r()):i(n())})}}function i(e){this.container=e,this.api=null,this.vpaidVersion=null}var o=e("util").inherits,s=e("events").EventEmitter,a=e("lie"),u=e("../enums/VPAID_EVENTS");o(i,s),Object.defineProperties(i.prototype,{adLinear:{get:r("getAdLinear")},adWidth:{get:r("getAdWidth")},adHeight:{get:r("getAdHeight")},adExpanded:{get:r("getAdExpanded")},adSkippableState:{get:r("getAdSkippableState")},adRemainingTime:{get:r("getAdRemainingTime")},adDuration:{get:r("getAdDuration")},adVolume:{get:r("getAdVolume"),set:r("setAdVolume")},adCompanions:{get:r("getAdCompanions")},adIcons:{get:r("getAdIcons")}}),i.prototype.load=function(){throw new Error("VPAID subclass must implement load() method.")},i.prototype.resizeAd=r("resizeAd",u.AdSizeChange),i.prototype.startAd=r("startAd",u.AdStarted),i.prototype.stopAd=r("stopAd",u.AdStopped),i.prototype.pauseAd=r("pauseAd",u.AdPaused),i.prototype.resumeAd=r("resumeAd",u.AdPlaying),i.prototype.expandAd=r("expandAd",u.AdExpandedChange),i.prototype.collapseAd=r("collapseAd",u.AdExpandedChange),i.prototype.skipAd=r("skipAd",u.AdSkipped),t.exports=i},{"../enums/VPAID_EVENTS":34,events:8,lie:10,util:24}],41:[function(e,t,n){"use strict";var r="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",i=r.length;t.exports=function(e){for(var t="";e--;)t+=r.charAt(Math.floor(Math.random()*i));return t}},{}],42:[function(e,t,n){t.exports=window},{}],43:[function(e,t,n){n.VAST=e("./lib/VAST")},{"./lib/VAST":44}],44:[function(e,t,n){"use strict";function r(){}function i(e){h({description:null,survey:null},e)}function o(){}function s(e){h({trackingEvents:[],parameters:null,videoClicks:null},e),(e.mediaFiles||[]).forEach(function(e){h({id:null,bitrate:null,scalable:null,maintainAspectRatio:null,apiFramework:null},e)})}function a(e){e.companions.forEach(function(e){h({expandedWidth:null,expandedHeight:null,apiFramework:null,trackingEvents:[],clickThrough:null,altText:null,parameters:null},e)})}function u(e){h({trackingEvents:[]},e),e.ads.forEach(function(e){h({id:null,expandedWidth:null,expandedHeight:null,scalable:null,maintainAspectRatio:null,minSuggestedDuration:null,apiFramework:null,clickThrough:null,parameters:null},e)})}function c(e){d(e,this,!0),this.ads.forEach(function(e){h({system:{version:null},errors:[]},e),e.creatives.forEach(function(e){h({id:null,sequence:null,adID:null},e),b[e.type](e)}),g[e.type](e)}),this.__private__={wrappers:[],inlines:[]}}var l=e("lie"),p=e("superagent"),d=e("./utils/copy"),h=e("./utils/defaults"),f=e("./utils/extend"),v=e("./utils/nodeify_promise"),y=Array.prototype.push,m=e("./xml_from_vast"),g={inline:i,wrapper:o},b={linear:s,companions:a,nonLinear:u};Object.defineProperties(c.prototype,{wrappers:{get:function(){var e=this.__private__.wrappers;return e.length=0,y.apply(e,this.filter("ads",function(e){return"wrapper"===e.type})),e}},inlines:{get:function(){var e=this.__private__.inlines;return e.length=0,y.apply(e,this.filter("ads",function(e){return"inline"===e.type})),e}}}),c.prototype.get=function(e){return((e||"").match(/[^\[\]\.]+/g)||[]).reduce(function(e,t){return(e||void 0)&&e[t]},this)},c.prototype.set=function(e,t){function n(e,t){switch(e.input.charAt(t)){case".":return Object;case"[":return Array;case"]":return n(e,t+1);default:return null}}var r=function(){for(var t,r=/[^\[\]\.]+/g,i=[];t=r.exec(e);)i.push({token:t[0],type:n(t,t.index+t[0].length)});return i}(),i=r.pop(),o=r.reduce(function(e,t){return e[t.token]||(e[t.token]=new t.type)},this);if(!e)throw new Error("prop must be specified.");return o[i.token]=t},c.prototype.map=function(e,t){var n=this.get(e)||[],r=n.length,i=[];if(!(n instanceof Array))return i;for(var o=0;o<r;o++)i.push(t.call(this,n[o],o,n));return i},c.prototype.filter=function(e,t){var n=this.get(e)||[],r=n.length,i=[];if(!(n instanceof Array))return i;for(var o=0;o<r;o++)t.call(this,n[o],o,n)&&i.push(n[o]);return i},c.prototype.find=function(e,t){var n=this.get(e)||[],r=n.length;if(n instanceof Array)for(var i=0;i<r;i++)if(t.call(this,n[i],i,n))return n[i]},c.prototype.toPOJO=function(){var e=JSON.parse(JSON.stringify(this));return delete e.__private__,e},c.prototype.copy=function(){return new this.constructor(this.toPOJO())},c.prototype.resolveWrappers=function(){function e(e,t){function n(e){return function(t){return t.type===e}}var r=function(e){return{linear:e.filter(n("linear")),companions:e.filter(n("companions")),nonLinear:e.filter(n("nonLinear"))}}(e.creatives);return h(e.impressions,t.impressions),h(e.errors,t.errors),void 0!==e.extensions&&h(e.extensions,t.extensions),t.creatives.forEach(function(e){h(r[e.type].shift()||{},e)}),y.apply(t.creatives,"wrapper"!==t.type?[]:["linear","companions","nonLinear"].reduce(function(e,t){return e.concat(r[t])},[])),t}var t=isNaN(arguments[0])?1/0:arguments[0],n="function"==typeof arguments[0]?arguments[0]:arguments[1],r=this.constructor,i=this;return 0===t?l.reject(new Error("Too many redirects were made.")):v(l.all(this.map("wrappers",function(e){return l.resolve(p.get(e.vastAdTagURI)).then(function(t){return{wrapper:e,response:r.pojoFromXML(t.text).ads}})})).then(function(t){var n=t.map(function(e){return e.wrapper}),o=t.map(function(e){return e.response});return new r(f(i.toPOJO(),{ads:i.map("ads",function(t){var r=n.indexOf(t),i=n[r],s=o[r];return s?s.map(e.bind(null,i)):[t]}).reduce(function(e,t){return e.concat(t)})}))}).then(function(e){return e.get("wrappers.length")>0?e.resolveWrappers(t-1):e}),n)},c.prototype.toXML=function(){var e=this.validate();if(!e.valid)throw new Error("VAST is invalid: "+e.reasons.join(", "));return m(this)},c.prototype.validate=function(){function e(e,t){e||s.push(t)}function t(t){e(o.get(t),t+" is required")}function n(t){e(o.get(t+".length")>0,t+" must contain at least one value")}function i(e,r){r.exists.map(e).forEach(t),r.atLeastOne.map(e).forEach(n)}var o=this,s=[],a={inline:function(e){var t={linear:function(e){i(e,{exists:["duration"],atLeastOne:["mediaFiles"]})},companions:function(e){o.get(e("companions")).forEach(function(t,n){function r(t){return e("companions["+n+"]."+t)}i(r,{exists:[],atLeastOne:["resources"]})})},nonLinear:function(e){o.get(e("ads")).forEach(function(t,n){function r(t){return e("ads["+n+"]."+t)}i(r,{exists:[],atLeastOne:["resources"]})})}};i(e,{exists:["title"],atLeastOne:["creatives"]}),o.get(e("creatives")).forEach(function(n,o){function s(t){return e("creatives["+o+"]."+t)}i(s,{exists:["type"],atLeastOne:[]}),(t[n.type]||r)(s)})},wrapper:function(e){i(e,{exists:["vastAdTagURI"],atLeastOne:[]})}};return i(function(e){return e},{exists:[],atLeastOne:["ads"]}),this.get("ads").forEach(function(e,t){function n(e){return"ads["+t+"]."+e}i(n,{exists:["type","system.name"],atLeastOne:["impressions"]}),(a[e.type]||r)(n)}),{valid:0===s.length,reasons:0===s.length?null:s}},c.pojoFromXML=e("./pojo_from_xml"),c.fetch=function(e){var t="object"==typeof arguments[1]?arguments[1]||{}:{},n="function"==typeof arguments[2]?arguments[2]:arguments[1],r=this;return v(l.resolve(p.get(e).set(t.headers||{})).then(function(e){var n=new r(r.pojoFromXML(e.text));return t.resolveWrappers?n.resolveWrappers(t.maxRedirects):n}),n)},t.exports=c},{"./pojo_from_xml":45,"./utils/copy":47,"./utils/defaults":48,"./utils/extend":49,"./utils/nodeify_promise":50,"./xml_from_vast":57,lie:10,superagent:18}],45:[function(e,t,n){"use strict";function r(e){return e[0]||{attributes:{}}}function i(e){return e.find("StaticResource,IFrameResource,HTMLResource").map(function(e){return{type:e.tag.replace(/Resource$/,"").toLowerCase(),creativeType:e.attributes.creativeType,data:e.value}})}function o(e){var t=r(e.find("Duration")),n=e.find("Tracking"),i=r(e.find("AdParameters")),o=e.find("VideoClicks")[0],s=e.find("MediaFile");return{type:"linear",duration:p(t.value)||void 0,trackingEvents:n.map(function(e){return{event:e.attributes.event,uri:e.value}}),parameters:i.value,videoClicks:o&&function(){var e=r(o.find("ClickThrough")),t=o.find("ClickTracking"),n=o.find("CustomClick");return{clickThrough:e.value,clickTrackings:t.map(function(e){return e.value}),customClicks:n.map(function(e){return{id:e.attributes.id,uri:e.value}})}}(),mediaFiles:s.map(function(e){var t=e.attributes;return{id:t.id,delivery:t.delivery,type:t.type,uri:e.value,bitrate:v(t.bitrate),width:v(t.width),height:v(t.height),scalable:d(t.scalable),maintainAspectRatio:d(t.maintainAspectRatio),apiFramework:t.apiFramework}})}}function s(e){return{type:"companions",companions:e.find("Companion").map(function(e){var t=e.find("Tracking"),n=r(e.find("CompanionClickThrough")),o=r(e.find("AltText")),s=r(e.find("AdParameters"));return{id:e.attributes.id,width:v(e.attributes.width),height:v(e.attributes.height),expandedWidth:v(e.attributes.expandedWidth),expandedHeight:v(e.attributes.expandedHeight),apiFramework:e.attributes.apiFramework,resources:i(e),trackingEvents:t.map(function(e){return{event:e.attributes.event,uri:e.value}}),clickThrough:n.value,altText:o.value,parameters:s.value}})}}function a(e){var t=e.find("NonLinear"),n=e.find("Tracking");return{type:"nonLinear",ads:t.map(function(e){var t=r(e.find("NonLinearClickThrough")),n=r(e.find("AdParameters"));return{id:e.attributes.id,width:v(e.attributes.width),height:v(e.attributes.height),expandedWidth:v(e.attributes.expandedWidth),expandedHeight:v(e.attributes.expandedHeight),scalable:d(e.attributes.scalable),maintainAspectRatio:d(e.attributes.maintainAspectRatio),minSuggestedDuration:p(e.attributes.minSuggestedDuration)||void 0,apiFramework:e.attributes.apiFramework,resources:i(e),clickThrough:t.value,parameters:n.value}}),trackingEvents:n.map(function(e){return{event:e.attributes.event,uri:e.value}})}}function u(e){var t=r(e.find("AdTitle")),n=r(e.find("Description")),i=r(e.find("Survey"));return{type:"inline",title:t.value,description:n.value,survey:i.value}}function c(e){return{type:"wrapper",vastAdTagURI:r(e.find("VASTAdTagURI")).value}}var l=e("./utils/parse_xml"),p=e("./utils/timestamp_to_seconds"),d=e("./utils/string_to_boolean"),h=e("./utils/extend"),f=e("./utils/trim_object"),v=e("./utils/numberify"),y={linear:o,companions:s,nonLinear:a},m={inline:u,wrapper:c};t.exports=function(e){var t=l(e);if(!t("VAST")[0])throw new Error("["+e+"] is not a valid VAST document.");return f({version:r(t("VAST")).attributes.version,ads:t("Ad").map(function(e){var t=r(e.find("Wrapper,InLine")).tag.toLowerCase(),n=r(e.find("AdSystem")),i=e.find("Error"),o=e.find("Impression"),s=e.find("Creative"),a=e.find("Extension"),u=a.map(function(e){if(e&&e.attributes)return e.value?e.value=e.value.replace(/^\s+|\s+$/,""):e.value="",{type:e.attributes.type,value:e.value}});return h({id:e.attributes.id,system:{name:n.value,version:n.attributes.version},errors:i.map(function(e){return e.value}),impressions:o.map(function(e){return{uri:e.value,id:e.attributes.id}}),extensions:u,creatives:s.map(function(e){var t=function(){switch(r(e.find("Linear,CompanionAds,NonLinearAds")).tag){case"Linear":return"linear";case"CompanionAds":return"companions";case"NonLinearAds":return"nonLinear"}}();return h({id:e.attributes.id,sequence:v(e.attributes.sequence),adID:e.attributes.AdID},y[t](e))})},m[t](e))})},!0)}},{"./utils/extend":49,"./utils/numberify":51,"./utils/parse_xml":52,"./utils/string_to_boolean":54,"./utils/timestamp_to_seconds":55,"./utils/trim_object":56}],46:[function(e,t,n){"use strict";function r(e){return null!==e&&void 0!==e}function i(e){return void 0!==e?String(e).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;"):""}function o(e){for(var t="";e--;)t+=" ";return t}function s(e){return(void 0!==e?function(e){for(var t,n,r=[],i=/]]>/g,o=0;t=i.exec(e);)n=t.index+2,r.push(t.input.substring(o,n)),o=n;return r.push(e.substring(o,e.length)),r}(String(e)):[""]).reduce(function(e,t){return e+"<![CDATA["+t+"]]>"},"")}function a(e){return e.cdata?s(e.value):i(e.value)}function u(e,t,n){var s=e.tag,c=e.attributes||{},l=Object.keys(c),p=e.children||[],d=e.value,h=p.length>0,f=l.every(function(e){return r(c[e])})&&l.length>0,v=r(d)||h||f,y=o(t),m="<"+s+Object.keys(c).reduce(function(e,t){return n&&!r(c[t])?e:e+" "+t+'="'+i(c[t])+'"'},"")+">",g="</"+s+">";return!n||v||e.required?h?[y+m].concat(e.children.reduce(function(e,r){return e.concat(u(r,t+4,n))},[]),[y+g]):[y+m+a(e)+g]:[]}t.exports=function(e,t){return['<?xml version="1.0" encoding="UTF-8"?>'].concat(u(e,0,t)).join("\n")}},{}],47:[function(e,t,n){"use strict";function r(e,t,n){return Object.keys(e).reduce(function(t,r){return t[r]=n?o(e[r],null,!0):e[r],t},t||{})}function i(e,t,n){var r=t||[];return s.apply(r,n?e.map(function(e){return o(e,null,!0)}):e),r}function o(e){var t=("object"==typeof arguments[1]||null)&&arguments[1],n="boolean"==typeof arguments[1]?arguments[1]:arguments[2];return Object(e)!==e?e:e instanceof Array?i(e,t,n):r(e,t,n)}var s=Array.prototype.push;t.exports=o},{}],48:[function(e,t,n){"use strict";function r(e){return Object(e)===e}function i(e){return e instanceof Array}var o=Array.prototype.push;t.exports=function e(t,n){return[t,n].every(i)?(o.apply(n,t.filter(function(e){return n.indexOf(e)<0})),n):Object.keys(t).reduce(function(n,i){return[t[i],n[i]].every(r)&&e(t[i],n[i]),i in n||(n[i]=t[i]),n},n)}},{}],49:[function(e,t,n){"use strict";t.exports=function(){return Array.prototype.slice.call(arguments).reduce(function(e,t){return Object.keys(t||{}).reduce(function(e,n){return e[n]=t[n],e},e)},{})}},{}],50:[function(e,t,n){"use strict";t.exports=function(e,t){return"function"!=typeof t?e:(e.then(function(e){t(null,e)},function(e){t(e)}),e)}},{}],51:[function(e,t,n){"use strict";t.exports=function(e){if(/string|number|boolean/.test(typeof e))return isNaN(e)?void 0:Number(e)}},{}],52:[function(e,t,n){"use strict";function r(e){var t=e.childElementCount>0;return{tag:e.tagName,value:t?null:e.textContent,attributes:a.call(e.attributes,function(e,t){return e[t.name]=t.value,e},{}),find:function(t){return i(e.querySelectorAll(t))},children:function(){return s.call(e.childNodes,function(e){return e instanceof Element}).map(r)}}}function i(e){return o.call(e,r)}var o=Array.prototype.map,s=Array.prototype.filter,a=Array.prototype.reduce,u=new DOMParser;t.exports=function(e){var t=u.parseFromString(e,"application/xml");return function(e){return i(t.querySelectorAll(e))}}},{}],53:[function(e,t,n){"use strict";function r(e){return(e>9?"":"0")+e.toString()}t.exports=function(e){return Number(e)!==e?null:[Math.floor(e/60/60),Math.floor(e/60%60),Math.floor(e%60%60)].map(r).join(":")}},{}],54:[function(e,t,n){"use strict";t.exports=function(e){switch((e||"").toLowerCase()){case"true":return!0;case"false":return!1}}},{}],55:[function(e,t,n){"use strict";t.exports=function(e){var t=(e||"").match(/^(\d\d):(\d\d):(\d\d)$/);return t&&t.slice(1,4).map(parseFloat).reduce(function(e,t,n){return e+t*Math.pow(60,Math.abs(n-2))},0)}},{}],56:[function(e,t,n){"use strict";t.exports=function e(t,n){return Object(t)!==t?t:Object.keys(t).reduce(function(r,i){return n&&t[i]instanceof Array?r[i]=t[i].filter(function(e){return void 0!==e}).map(function(t){return e(t,!0)}):n&&t[i]instanceof Object?r[i]=e(t[i],!0):void 0!==t[i]&&(r[i]=t[i]),r},{})}},{}],57:[function(e,t,n){"use strict";function r(e){return{tag:"TrackingEvents",children:e.map(function(e){return{tag:"Tracking",attributes:{event:e.event},value:e.uri,cdata:!0}})}}function i(e){return e.map(function(e){return{tag:function(e){switch(e){case"static":return"StaticResource";case"iframe":return"IFrameResource";case"html":return"HTMLResource"}}(e.type),attributes:{creativeType:e.creativeType},value:e.data,cdata:!0}})}function o(e){return{tag:"AdParameters",value:e.parameters}}function s(e){return{tag:"Linear",children:[{tag:"Duration",value:c(e.duration)},r(e.trackingEvents),o(e)].concat(e.videoClicks?[{tag:"VideoClicks",children:[{tag:"ClickThrough",value:e.videoClicks.clickThrough,cdata:!0}].concat(e.videoClicks.clickTrackings.map(function(e){return{tag:"ClickTracking",value:e,cdata:!0}}),e.videoClicks.customClicks.map(function(e){return{tag:"CustomClick",attributes:{id:e.id},value:e.uri,cdata:!0}}))}]:[],[{tag:"MediaFiles",children:e.mediaFiles.map(function(e){return{tag:"MediaFile",attributes:{id:e.id,width:e.width,height:e.height,bitrate:e.bitrate,type:e.type,delivery:e.delivery,scalable:e.scalable,maintainAspectRatio:e.maintainAspectRatio,apiFramework:e.apiFramework},value:e.uri,cdata:!0}})}])}}function a(e){return{tag:"CompanionAds",children:e.companions.map(function(e){return{tag:"Companion",attributes:{id:e.id,width:e.width,height:e.height,expandedWidth:e.expandedWidth,expandedHeight:e.expandedHeight,apiFramework:e.apiFramework},children:i(e.resources).concat([r(e.trackingEvents),{tag:"CompanionClickThrough",value:e.clickThrough,cdata:!0},{tag:"AltText",value:e.altText},o(e)])}})}}function u(e){return{tag:"NonLinearAds",children:e.ads.map(function(e){return{tag:"NonLinear",attributes:{id:e.id,width:e.width,height:e.height,expandedWidth:e.expandedWidth,expandedHeight:e.expandedHeight,scalable:e.scalable,maintainAspectRatio:e.maintainAspectRatio,minSuggestedDuration:c(e.minSuggestedDuration),apiFramework:e.apiFramework},children:i(e.resources).concat([{tag:"NonLinearClickThrough",value:e.clickThrough,cdata:!0},o(e)])}}).concat([r(e.trackingEvents)])}}var c=e("./utils/seconds_to_timestamp"),l=e("./utils/compile_xml"),p={linear:s,companions:a,nonLinear:u};t.exports=function(e){return l({tag:"VAST",attributes:{version:e.get("version")},children:e.map("ads",function(e){return{tag:"Ad",attributes:{id:e.id},children:[{tag:function(){switch(e.type){case"inline":return"InLine";case"wrapper":return"Wrapper"}}(),children:[{tag:"AdSystem",attributes:{version:e.system.version},value:e.system.name},{tag:"AdTitle",value:e.title},{tag:"Description",value:e.description},{tag:"Survey",value:e.survey,cdata:!0},{tag:"VASTAdTagURI",value:e.vastAdTagURI,cdata:!0}].concat(e.errors.map(function(e){return{tag:"Error",value:e,cdata:!0}}),e.impressions.map(function(e){return{tag:"Impression",value:e.uri,cdata:!0,attributes:{id:e.id}}}),[{tag:"Creatives",children:e.creatives.map(function(e){return{tag:"Creative",attributes:{id:e.id,sequence:e.sequence,AdID:e.adID},children:[function(t){return p[t](e)}(e.type)]}}),required:!0}])}]}})},!0)}},{"./utils/compile_xml":46,"./utils/seconds_to_timestamp":53}],58:[function(e,t,n){"use strict";var r=e("./../models/dispatcher"),i=e("./../models/configurator"),o=e("./../models/YoutubePlayer").player;window.mydispatcher=r,window.Configurator=i,window.YouTubePlayer=o},{"./../models/YoutubePlayer":3,"./../models/configurator":4,"./../models/dispatcher":5}]},{},[58]);